<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rato 3D - Gato Corrigido</title>

    <script src="matrizes.js"></script>
    <script src="leitor.js"></script>
    <script src="cenario.js"></script>
    <script src="controles.js"></script>
    <script src="colisao.js"></script>
    <script src="main.js"></script>

    <script id="vertex-shader" type="notjs">
        attribute vec4 position;
        attribute vec3 normal;
        attribute vec2 texCoord;

        uniform mat4 transf;
        uniform mat4 u_model;

        varying vec3 v_normal;
        varying vec3 v_pos;
        varying vec2 v_texCoord;

        void main() {
            v_pos = vec3(u_model * position);
            v_normal = mat3(u_model) * normal;
            
            // Inverte o eixo Y da textura manualmente
            v_texCoord = vec2(texCoord.x, 1.0 - texCoord.y);
            
            gl_Position = transf * position;
        }
    </script>

    <script id="frag-shader" type="notjs">
        precision mediump float;

        varying vec3 v_normal;
        varying vec3 v_pos;
        varying vec2 v_texCoord;

        uniform sampler2D tex;
        uniform vec3 u_lightPos;
        uniform vec3 u_viewPos;
        uniform float u_useTexture;
        uniform vec3 u_baseColor; // Vari√°vel para as cores (Rato/Queijo)

        void main() {
            vec3 lightColor = vec3(1.0, 1.0, 1.0);
            
            // 1. ILUMINA√á√ÉO AMBIENTE
            vec3 ambient = 0.2 * lightColor;
            
            // 2. ILUMINA√á√ÉO DIFUSA (Lambert)
            vec3 norm = normalize(v_normal);
            vec3 lightDir = normalize(u_lightPos - v_pos);
            float diff = max(dot(norm, lightDir), 0.0);
            vec3 diffuse = diff * lightColor;
            
            // 3. ILUMINA√á√ÉO ESPECULAR (Phong)
            vec3 viewDir = normalize(u_viewPos - v_pos);
            vec3 reflectDir = reflect(-lightDir, norm);  
            float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
            vec3 specular = 0.2 * spec * lightColor;  
                
            // Determina√ß√£o da cor base
            vec4 baseColor;
            if(u_useTexture > 0.5) {
                baseColor = texture2D(tex, v_texCoord);
            } else {
                // Se n√£o houver textura, usa a cor passada pelo JavaScript
                baseColor = vec4(u_baseColor, 1.0);
            }

            // C√°lculo final com modelo de Phong aplicado √† cor base
            vec3 phong = (ambient + diffuse + specular) * baseColor.rgb;
            gl_FragColor = vec4(phong, baseColor.a);
        }
    </script>
</head>

<body onload="initApp()"> <div id="tela-menu" style="
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #222; display: flex; flex-direction: column;
        align-items: center; justify-content: center; z-index: 10;">
        
        <h1 style="color: #FFD700; font-size: 80px; font-family: sans-serif; margin-bottom: 50px; text-shadow: 4px 4px 0 #000;">
            RATO 3D
        </h1>
        
        <button id="btn-jogar" style="
            padding: 20px 60px; font-size: 30px; margin: 10px; cursor: pointer;
            background: #4CAF50; color: white; border: none; border-radius: 10px;">
            JOGAR
        </button>
        
        <button id="btn-sair" style="
            padding: 20px 60px; font-size: 30px; margin: 10px; cursor: pointer;
            background: #f44336; color: white; border: none; border-radius: 10px;">
            SAIR
        </button>
    </div>
<div id="tela-objetivo" style="
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.95); display: none; flex-direction: column;
        align-items: center; justify-content: center; z-index: 11; text-align: center;">
        
        <h1 style="color: #FFD700; font-family: sans-serif; font-size: 60px; margin-bottom: 20px;">
            SUA MISS√ÉO
        </h1>
        
        <div style="font-size: 100px; margin: 20px;">üßÄ</div> <p style="color: white; font-family: sans-serif; font-size: 28px; max-width: 600px; line-height: 1.5;">
            Voc√™ √© um rato faminto em um labirinto.<br>
            Existem <strong style="color: #FFD700;">5 peda√ßos de queijo</strong> escondidos.
        </p>
        
        <p style="color: #ccc; font-family: sans-serif; font-size: 22px; margin-bottom: 40px;">
            Encontre todos eles o mais r√°pido poss√≠vel!
        </p>

        <button id="btn-comecar-missao" style="
            padding: 20px 60px; font-size: 24px; cursor: pointer;
            background: #FFD700; color: #222; font-weight: bold;
            border: none; border-radius: 50px; box-shadow: 0 0 15px #FFD700;">
            ENTENDIDO, VAMOS COMER!
        </button>
    </div>
    <div id="tela-ranking" style="
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #111; display: none; flex-direction: column;
        align-items: center; justify-content: center; z-index: 10;">
        
        <h1 style="color: white; font-family: sans-serif; margin-bottom: 10px;">TOP 5 TEMPOS</h1>
        
        <h2 style="color: #00FFFF; font-family: monospace; font-size: 30px; margin-bottom: 30px;">
            SEU TEMPO: <span id="display-tempo-atual">0.00</span>s
        </h2>
        <ul id="lista-ranking" style="
            list-style: none; padding: 0; color: white; font-size: 24px; 
            font-family: monospace; text-align: center; margin-bottom: 40px;">
            </ul>

        <button id="btn-voltar" style="padding: 15px 40px; font-size: 20px; cursor: pointer;">
            VOLTAR AO MENU
        </button>
    </div>

    <div id="ui-jogo" style="display: none;">
        <div id="ui-placar" style="
            position: absolute; top: 20px; left: 20px; 
            color: white; font-family: Arial; font-size: 32px; font-weight: bold;
            text-shadow: 2px 2px 4px #000; pointer-events: none;">
            QUEIJOS: <span id="contador">0</span> / 5
        </div>

        <div id="ui-tempo" style="
            position: absolute; top: 60px; left: 20px; 
            color: #00FFFF; font-family: Arial; font-size: 28px; font-weight: bold;
            text-shadow: 2px 2px 4px #000; pointer-events: none;">
            TEMPO: <span id="timer">0.0</span>s
        </div>
    </div>

    <canvas id="glcanvas1" width="1600" height="1000" style="display: none;"></canvas>

    <div id="ui-vitoria" style="
        display: none; position: absolute; top: 50%; left: 50%; 
        transform: translate(-50%, -50%); color: #FFD700; 
        font-family: Arial; font-size: 60px; font-weight: bold; 
        text-shadow: 4px 4px 0px #000; text-align: center; pointer-events: none;">
        FIM DE JOGO!
    </div>

    <script src="matrizes.js"></script>
    <script src="leitor.js"></script>
    <script src="cenario.js"></script>
    <script src="colisao.js"></script>
    <script src="controles.js"></script>
    <script src="menu.js"></script> <script src="main.js"></script>
</body>
</html>