<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rato 3D</title>

    <script src="matrizes.js"></script>
    <script src="leitor.js"></script>
    <script src="main.js"></script>

    <script id="vertex-shader" type="notjs">
        attribute vec4 position;
        attribute vec3 normal;   // Direção da face
        attribute vec2 texCoord;  // Atributo de textura 

        uniform mat4 transf;      //matriz Model-View-Projection
        uniform mat4 u_model;    // Apenas a Model Matrix para posicionar a luz

        varying vec3 v_normal;
        varying vec3 v_pos;
        varying vec2 v_texCoord;

        void main() {
            v_pos = vec3(u_model * position);
            v_normal = mat3(u_model) * normal; // Transforma a normal junto com o objeto
            v_texCoord = texCoord;
            gl_Position = transf * position;
        }
    </script>
    <script id="frag-shader" type="notjs">
    precision mediump float;

    varying vec3 v_normal;
    varying vec3 v_pos;
    varying vec2 v_texCoord;

    uniform sampler2D tex;
    uniform vec3 u_lightPos;
    uniform vec3 u_viewPos;
    uniform float u_useTexture; // Mantendo o interruptor para cor/textura

    void main() {
        vec3 lightColor = vec3(1.0, 1.0, 1.0);
        
        // 1. AMBIENTE
        vec3 ambient = 0.2 * lightColor;
        
        // 2. DIFUSA
        vec3 norm = normalize(v_normal);
        vec3 lightDir = normalize(u_lightPos - v_pos);
        float diff = max(dot(norm, lightDir), 0.0);
        vec3 diffuse = diff * lightColor;
        
        // 3. ESPECULAR
        vec3 viewDir = normalize(u_viewPos - v_pos);
        vec3 reflectDir = reflect(-lightDir, norm);  
        float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
        vec3 specular = 0.2 * spec * lightColor;  
            
        // Decisão entre textura ou cor base (usando branco como base para textura)
        vec4 baseColor = vec4(1.0, 1.0, 1.0, 1.0);
        if(u_useTexture > 0.5) {
            baseColor = texture2D(tex, v_texCoord);
        }

        vec3 phong = (ambient + diffuse + specular) * baseColor.rgb;
        gl_FragColor = vec4(phong, baseColor.a);
    }
</script>
</head>

<body onload="init()">
    <canvas id="glcanvas1" width="900" height="700"></canvas>
</body>
</html>