<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rato 3D - Gato Corrigido</title>

    <script src="matrizes.js"></script>
    <script src="leitor.js"></script>
    <script src="cenario.js"></script>
    <script src="controles.js"></script>
    <script src="colisao.js"></script>
    <script src="main.js"></script>

    <script id="vertex-shader" type="notjs">
        attribute vec4 position;
        attribute vec3 normal;
        attribute vec2 texCoord;

        uniform mat4 transf;
        uniform mat4 u_model;

        varying vec3 v_normal;
        varying vec3 v_pos;
        varying vec2 v_texCoord;

        void main() {
            v_pos = vec3(u_model * position);
            v_normal = mat3(u_model) * normal;
            
            // Inverte o eixo Y da textura manualmente
            v_texCoord = vec2(texCoord.x, 1.0 - texCoord.y);
            
            gl_Position = transf * position;
        }
    </script>

    <script id="frag-shader" type="notjs">
        precision mediump float;

        varying vec3 v_normal;
        varying vec3 v_pos;
        varying vec2 v_texCoord;

        uniform sampler2D tex;
        uniform vec3 u_lightPos;
        uniform vec3 u_viewPos;
        uniform float u_useTexture;
        uniform vec3 u_baseColor; // Variável para as cores (Rato/Queijo)

        void main() {
            vec3 lightColor = vec3(1.0, 1.0, 1.0);
            
            // 1. ILUMINAÇÃO AMBIENTE
            vec3 ambient = 0.2 * lightColor;
            
            // 2. ILUMINAÇÃO DIFUSA (Lambert)
            vec3 norm = normalize(v_normal);
            vec3 lightDir = normalize(u_lightPos - v_pos);
            float diff = max(dot(norm, lightDir), 0.0);
            vec3 diffuse = diff * lightColor;
            
            // 3. ILUMINAÇÃO ESPECULAR (Phong)
            vec3 viewDir = normalize(u_viewPos - v_pos);
            vec3 reflectDir = reflect(-lightDir, norm);  
            float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
            vec3 specular = 0.2 * spec * lightColor;  
                
            // Determinação da cor base
            vec4 baseColor;
            if(u_useTexture > 0.5) {
                baseColor = texture2D(tex, v_texCoord);
            } else {
                // Se não houver textura, usa a cor passada pelo JavaScript
                baseColor = vec4(u_baseColor, 1.0);
            }

            // Cálculo final com modelo de Phong aplicado à cor base
            vec3 phong = (ambient + diffuse + specular) * baseColor.rgb;
            gl_FragColor = vec4(phong, baseColor.a);
        }
    </script>
</head>

<body onload="init()">
    
    <canvas id="glcanvas1" width="1600" height="1000"></canvas>

  <div id="ui-placar" style="
        position: absolute; 
        top: 20px; left: 20px; 
        color: white; font-family: Arial, sans-serif; 
        font-size: 32px; font-weight: bold;
        text-shadow: 2px 2px 4px #000; pointer-events: none;">
        QUEIJOS: <span id="contador">0</span> / 5
    </div>

    <div id="ui-tempo" style="
        position: absolute; 
        top: 60px; left: 20px; 
        color: #00FFFF; /* Cor Ciano para diferenciar */
        font-family: Arial, sans-serif; 
        font-size: 28px; font-weight: bold;
        text-shadow: 2px 2px 4px #000; pointer-events: none;">
        TEMPO: <span id="timer">0.0</span>s
    </div>

    <div id="ui-vitoria" style="
        display: none; position: absolute; top: 50%; left: 50%; 
        transform: translate(-50%, -50%); 
        color: #FFD700; font-family: Arial, sans-serif; 
        font-size: 60px; font-weight: bold;
        text-shadow: 4px 4px 0px #000; text-align: center; pointer-events: none;">
        DELICIOSO! <br>
        <span style="font-size: 30px; color: white;">Tempo Final: <span id="tempo-final"></span>s</span><br>
        <span style="font-size: 20px; color: #ccc;">F5 para reiniciar</span>
    </div>

</body>
</html>